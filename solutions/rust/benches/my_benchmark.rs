use criterion::{black_box, criterion_group, criterion_main, Criterion};
use parse_kata::{decode_json_string, find_index_of_last_incomplete_line};

pub fn find_index_of_last_incomplete_line_benchmark(c: &mut Criterion) {
    let s = r#"/type/work	/works/OL10509530W	1	2009-12-11T03:05:25.643398	{"title": "La litterature Francaise aux 19e et 20e siecles", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:25.643398"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:25.643398"}, "latest_revision": 1, "key": "/works/OL10509530W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4360923A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10509569W	2	2010-12-19T07:49:17.178329	{"title": "Les petites filles et los queriers", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:25.643398"}, "last_modified": {"type": "/type/datetime", "value": "2010-12-19T07:49:17.178329"}, "latest_revision": 2, "key": "/works/OL10509569W", "authors": [{"type": {"key": "/type/author_role"}, "author": {"key": "/authors/OL4360936A"}}], "type": {"key": "/type/work"}, "revision": 2}
    /type/work	/works/OL10509945W	2	2017-03-27T22:01:03.431788	{"title": "Twenty-five years", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:25.643398"}, "last_modified": {"type": "/type/datetime", "value": "2017-03-27T22:01:03.431788"}, "latest_revision": 2, "key": "/works/OL10509945W", "authors": [{"type": {"key": "/type/author_role"}, "author": {"key": "/authors/OL115188A"}}], "type": {"key": "/type/work"}, "revision": 2}
    /type/work	/works/OL10510490W	1	2009-12-11T03:05:29.585806	{"title": "Pour l'Europe", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:29.585806"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:29.585806"}, "latest_revision": 1, "key": "/works/OL10510490W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4361267A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10510723W	3	2010-12-06T07:44:41.177476	{"created": {"type": "/type/datetime", "value": "2009-12-11T03:05:29.585806"}, "subject_places": ["Ireland"], "subjects": ["Examinations", "Interpretation", "Universities and colleges", "University College Dublin"], "latest_revision": 3, "key": "/works/OL10510723W", "title": "Leaving Certificate points and performance in first arts economics", "authors": [{"type": {"key": "/type/author_role"}, "author": {"key": "/authors/OL4361370A"}}], "type": {"key": "/type/work"}, "last_modified": {"type": "/type/datetime", "value": "2010-12-06T07:44:41.177476"}, "revision": 3}
    /type/work	/works/OL10511033W	1	2009-12-11T03:05:29.585806	{"title": "Annual report and accounts", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:29.585806"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:29.585806"}, "latest_revision": 1, "key": "/works/OL10511033W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4361430A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10511053W	1	2009-12-11T03:05:29.585806	{"title": "Community supervision orders", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:29.585806"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:29.585806"}, "latest_revision": 1, "key": "/works/OL10511053W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4361430A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10511527W	1	2009-12-11T03:05:35.628713	{"title": "Biofeedback", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:35.628713"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:35.628713"}, "latest_revision": 1, "key": "/works/OL10511527W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4361557A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10511903W	1	2009-12-11T03:05:35.628713	{"title": "The public schools to-day", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:35.628713"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:35.628713"}, "latest_revision": 1, "key": "/works/OL10511903W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4361724A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10511904W	3	2021-09-18T22:25:24.651116	{"title": "The analysis of knowledge", "key": "/works/OL10511904W", "authors": [{"type": {"key": "/type/author_role"}, "author": {"key": "/authors/OL4361725A"}}], "type": {"key": "/type/work"}, "subjects": ["Knowledge, theory of"], "latest_revision": 3, "revision": 3, "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:35.628713"}, "last_modified": {"type": "/type/datetime", "value": "2021-09-18T22:25:24.651116"}}
    /type/work	/works/OL10512028W	1	2009-12-11T03:05:35.628713	{"title": "Magnetic properties of Alcomax 111 at 50Hz excitation", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:35.628713"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:35.628713"}, "latest_revision": 1, "key": "/works/OL10512028W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4361789A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10512114W	2	2010-01-17T18:32:16.369530	{"created": {"type": "/type/datetime", "value": "2009-12-11T03:05:35.628713"}, "title": "The fundamentals of statistical reasoning", "last_modified": {"type": "/type/datetime", "value": "2010-01-17T18:32:16.369530"}, "latest_revision": 2, "key": "/works/OL10512114W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4361860A"}}], "type": {"key": "/type/work"}, "subjects": ["Mathematical statistics"], "revision": 2}
    /type/work	/works/OL10512404W	1	2009-12-11T03:05:35.628713	{"title": "Los hombres y sus sombras", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:35.628713"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:35.628713"}, "latest_revision": 1, "key": "/works/OL10512404W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4362035A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10512678W	1	2009-12-11T03:05:42.688103	{"title": "Planirovanie narodnogo khozyaistva v oblasti", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "latest_revision": 1, "key": "/works/OL10512678W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4362222A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10512717W	1	2009-12-11T03:05:42.688103	{"title": "The invertebrate panorama", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "latest_revision": 1, "key": "/works/OL10512717W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4362243A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10512874W	1	2009-12-11T03:05:42.688103	{"title": "Value added tax", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "latest_revision": 1, "key": "/works/OL10512874W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4362318A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10512886W	1	2009-12-11T03:05:42.688103	{"title": "'The  dream of the rood'", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "latest_revision": 1, "key": "/works/OL10512886W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4362328A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10513002W	3	2010-12-03T14:17:53.389605	{"last_modified": {"type": "/type/datetime", "value": "2010-12-03T14:17:53.389605"}, "latest_revision": 3, "key": "/works/OL10513002W", "authors": [{"type": {"key": "/type/author_role"}, "author": {"key": "/authors/OL4362371A"}}], "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "title": "Some more considerations proving the unreasonableness of the Romanists in requiring us to return to the communion of the present Romish-church. By William Squire", "subject_places": ["Great Britain"], "subjects": ["Catholic Church", "Church history", "Church polity", "Controversial literature", "Early works to 1800"], "subject_times": ["17th century"], "type": {"key": "/type/work"}, "revision": 3}
    /type/work	/works/OL10513214W	1	2009-12-11T03:05:42.688103	{"title": "The underflow of the South Platte Valley", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "latest_revision": 1, "key": "/works/OL10513214W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4362528A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10513236W	1	2009-12-11T03:05:42.688103	{"title": "Commercial information", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "last_modified": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "latest_revision": 1, "key": "/works/OL10513236W", "authors": [{"type": "/type/author_role", "author": {"key": "/authors/OL4362549A"}}], "type": {"key": "/type/work"}, "revision": 1}
    /type/work	/works/OL10513382W	4	2020-10-10T23:43:03.990436	{"last_modified": {"type": "/type/datetime", "value": "2020-10-10T23:43:03.990436"}, "title": "Insects", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:42.688103"}, "subjects": ["Insects, pictorial works"], "latest_revision": 4, "key": "/works/OL10513382W", "authors": [{"type": {"key": "/type/author_role"}, "author": {"key": "/authors/OL841345A"}}], "type": {"key": "/type/work"}, "revision": 4}
    /type/work	/works/OL10513815W	3	2019-12-27T16:30:46.678777	{"title": "A manual of practical chemistry", "created": {"type": "/type/datetime", "value": "2009-12-11T03:05:49.332401"}, "last_modified": {"type": "/type/datetime", "value": "2019-12-27T16:30:46.678777"}, "latest_revision": 3, "key": "/works/OL10513815W", "authors": [{"type": {"key": "/type/author_role"}, "author": {"key": "/authors/OL5634689A"}}], "type": {"key": "/type/work"}, "revision": 3}
    /type/work	/works/OL10513868W	1	2009-12-11T03:05:49.332401	{"title": "Polynucle"#;
    let v: Vec<u8> = s.as_bytes().to_vec();

    c.bench_function("find_index_of_last_incomplete_line", |b| {
        b.iter(|| find_index_of_last_incomplete_line(black_box(&v)))
    });
}

pub fn json_to_rust_unicode_benchmark(c: &mut Criterion) {
    let input = r#""example\u0047\u0075hello\u0069\u0064world""#.as_bytes();

    c.bench_function("decode_json_string", |b| {
        b.iter(|| decode_json_string(black_box(input)))
    });

    c.bench_function("serde_json", |b| {
        b.iter(|| serde_json::from_slice(black_box(input)).unwrap_or(String::new()));
    });
}

criterion_group!(
    benches,
    find_index_of_last_incomplete_line_benchmark,
    json_to_rust_unicode_benchmark
);
criterion_main!(benches);
